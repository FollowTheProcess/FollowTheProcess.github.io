<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Pyenv is Awesome!</title><meta name=description content="Pyenv solves the entire python installation/virtual environment situation."><meta name=keywords content="python,virtual environments,installation"><meta property="og:url" content="https://followtheprocess.github.io/posts/pyenv/"><meta property="og:type" content="website"><meta property="og:title" content="Pyenv is Awesome!"><meta property="og:description" content="Pyenv solves the entire python installation/virtual environment situation."><meta property="og:image" content="https://followtheprocess.github.io/images/profile.jpg"><meta property="og:image:secure_url" content="https://followtheprocess.github.io/images/profile.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Pyenv is Awesome!"><meta name=twitter:description content="Pyenv solves the entire python installation/virtual environment situation."><meta property="twitter:domain" content="https://followtheprocess.github.io/posts/pyenv/"><meta property="twitter:url" content="https://followtheprocess.github.io/posts/pyenv/"><meta name=twitter:image content="https://followtheprocess.github.io/images/profile.jpg"><link rel=canonical href=https://followtheprocess.github.io/posts/pyenv/><link rel=stylesheet type=text/css href=https://followtheprocess.github.io/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://followtheprocess.github.io/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://followtheprocess.github.io/css/dark.css><script src=https://followtheprocess.github.io/js/svg-injector.min.js></script>
<script src=https://followtheprocess.github.io/js/feather-icons.min.js></script>
<script src=https://followtheprocess.github.io/js/main.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css integrity=sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js integrity=sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://followtheprocess.github.io><img src=https://followtheprocess.github.io/images/profile.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://followtheprocess.github.io>@FollowTheProcess</a></div><div class=nav-links><div class=nav-link><a href=https://followtheprocess.github.io/>Home</a></div><div class=nav-link><a href=https://followtheprocess.github.io/posts/>Posts</a></div><div class=nav-link><a href=https://followtheprocess.github.io/projects/>Projects</a></div><div class=nav-link><a href=https://followtheprocess.github.io/cv/>CV</a></div><div class=nav-link><a href=https://github.com/FollowTheProcess/><span data-feather=github></span></a></div><div class=nav-link><a href=https://twitter.com/FollowTheProc><span data-feather=twitter></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://followtheprocess.github.io/>Home</a></li><li class=nav-item><a href=https://followtheprocess.github.io/posts/>Posts</a></li><li class=nav-item><a href=https://followtheprocess.github.io/projects/>Projects</a></li><li class=nav-item><a href=https://followtheprocess.github.io/cv/>CV</a></li><li class=nav-item><a href=https://github.com/FollowTheProcess/><span data-feather=github></span></a></li><li class=nav-item><a href=https://twitter.com/FollowTheProc><span data-feather=twitter></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Pyenv is Awesome!</h1><small role=doc-subtitle>Pyenv solves the entire python installation/virtual environment situation.</small><p class=post-date>February 19, 2021</p><ul class=post-tags><li class=post-tag><a href=https://followtheprocess.github.io/tags/python>python</a></li><li class=post-tag><a href=https://followtheprocess.github.io/tags/virtual-environments>virtual environments</a></li><li class=post-tag><a href=https://followtheprocess.github.io/tags/installation>installation</a></li></ul></div><div class=post-content><p><p>I think everyone who has touched python at some point has seen this picture&mldr;</p><p><img src=/images/posts/python_environment.png alt="environment hell"></p><p>It&rsquo;s mainly poking fun at the kinds of ways you can get your installation all screwed up if you&rsquo;re not careful but is often misinterpreted as throwing shade on how python works.</p><p><a href=https://snarky.ca/deconstructing-xkcd-com-1987/>Brett Cannon&rsquo;s Blog Post</a> has an excellent deconstruction of what this xkcd means and how to avoid it.</p><p>There&rsquo;s lots you can do to avoid this happening to you. My favourite method is <a href=https://github.com/pyenv/pyenv>pyenv</a>.</p><h2 id=what>What?</h2><p>Unlike other ways of installing python, or using your system installation (which you should <strong>NEVER</strong> do), <a href=https://github.com/pyenv/pyenv>pyenv</a> actually compiles a version of python direct from source and stores it in it&rsquo;s own special directory far far away from your system python.</p><p>So far so good üëç.</p><p>Once it&rsquo;s finished making this <strong>completely separate</strong> python for you. You can set <em>that</em> version of python to be your global one. Meaning that even if you open up a terminal and do something like&mldr;</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>python
</span></span></code></pre></div><p>And instead of your system&rsquo;s <code>python3</code> (or worse it&rsquo;s <code>python</code> - meaning python2.7), it will fire up your new, pyenv-managed, python version you just installed.</p><p>This all means that if you follow this guide, your installation will <strong>NEVER</strong> end up like the one in the now infamous xkcd above. Your system python (both 3 and 2) will remain a completely hidden layer below where you work and you will never need to touch it.</p><p>That&rsquo;s one less thing to worry about whilst you&rsquo;re trying to figure out how to actually do programming‚Ñ¢Ô∏è.</p><h2 id=installation>Installation</h2><p>Now installing it on my mac was pretty straightforward but it can throw errors if you get a step wrong so I&rsquo;ll share the script I used in case its useful to anyone else.</p><p>For this to work though, we&rsquo;re going to need to install some compilation dependencies. If you have <a href=https://brew.sh>homebrew</a> this is what you&rsquo;ll need to do&mldr;</p><p>And if you haven&rsquo;t got homebrew&mldr; get homebrew. You can thank me later.</p><h3 id=install-xcode-command-line-developer-tools>Install xcode command line developer tools</h3><p>These provide C compilers and other handy things we&rsquo;ll need later.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>xcode-select --install
</span></span></code></pre></div><h3 id=install-compiler-dependencies-from-homebrew>Install compiler dependencies from Homebrew</h3><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Python build dependencies</span>
</span></span><span style=display:flex><span>brew install zlib
</span></span><span style=display:flex><span>brew install xz
</span></span><span style=display:flex><span>brew install openssl
</span></span><span style=display:flex><span>brew install readline
</span></span><span style=display:flex><span>brew install sqlite3
</span></span><span style=display:flex><span>brew install openblas
</span></span></code></pre></div><p><em>Side note: <code>openblas</code> isn&rsquo;t strictly required, but it comes in handy if you later want to install python-C libraries like <a href=https://pandas.pydata.org>pandas</a> or <a href=https://numpy.org>numpy</a>.</em></p><h3 id=build-a-python-from-scratch>Build a Python from Scratch</h3><p>Now we have pyenv installed, we need to use it to create a python version for us. It does this by literally compiling the python source code to the special pyenv folder rather than any predistributed binaries or wheels etc.</p><p>However, the compilers don&rsquo;t necessarily always find the correct dependencies that we just installed so we have to manually point them to the right tools using compiler flags.</p><p>This is the step that was tricky, every time I tried a simple <code>pyenv install 3.9.1</code> it would only get so far and not compile. It turns out it&rsquo;s best to specify exactly where all the tools are to the compilers.</p><p>I found the easiest way to do this was to put it in a small bash script that I called <code>pyenv_install.sh</code>, shown in the snippet below. I would just recommend copying and pasting this, this is the exact script that works for me (macOS Big Sur, Intel chip).</p><p>Feel free to replace the <code>3.9.1</code> with whatever version of python you want (you should probably pick one of the currently supported ones though: 3.6, 3.7, 3.8 and 3.9 at time of writing). You can also run <code>pyenv install --list</code> to see all the many different versions of python you could install this way.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#8b949e;font-weight:700;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Pointing pyenv to the correct compilers</span>
</span></span><span style=display:flex><span>export <span style=color:#79c0ff>LDFLAGS</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;-L</span><span style=color:#ff7b72>$(</span>brew --prefix zlib<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/lib -L</span><span style=color:#ff7b72>$(</span>brew --prefix bzip2<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/lib -L</span><span style=color:#ff7b72>$(</span>brew --prefix openssl<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/lib -L</span><span style=color:#ff7b72>$(</span>brew --prefix readline<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/lib&#34;</span>
</span></span><span style=display:flex><span>export <span style=color:#79c0ff>CPPFLAGS</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;-I</span><span style=color:#ff7b72>$(</span>brew --prefix zlib<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/include -I</span><span style=color:#ff7b72>$(</span>brew --prefix bzip2<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/include&#34;</span>
</span></span><span style=display:flex><span>export <span style=color:#79c0ff>CFLAGS</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#34;-I</span><span style=color:#ff7b72>$(</span>brew --prefix openssl<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/include -I</span><span style=color:#ff7b72>$(</span>brew --prefix bzip2<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/include -I</span><span style=color:#ff7b72>$(</span>brew --prefix readline<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/include -I</span><span style=color:#ff7b72>$(</span>xcrun --show-sdk-path<span style=color:#ff7b72>)</span><span style=color:#a5d6ff>/usr/include&#34;</span>
</span></span><span style=display:flex><span>pyenv install 3.9.1 <span style=color:#8b949e;font-style:italic># Or your version</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#a5d6ff>&#34;Don&#39;t forget to make this the global python using pyenv global x.x.x&#34;</span>
</span></span></code></pre></div><p>Pyenv will now build that version of python from source. Once it&rsquo;s finished, restart your terminal then run&mldr;</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>pyenv global 3.9.1  <span style=color:#8b949e;font-style:italic># Or whatever version you installed</span>
</span></span></code></pre></div><p>And that&rsquo;s it! You know have a python installation <strong>completely</strong> separate from your system python(s)! üéâ</p><h3 id=how-to-use-it>How to use it</h3><p>I treat mine almost as if its the system installation, except with comfort in the knowledge that it&rsquo;s not and if all hell breaks loose I can always just <code>pyenv uninstall 3.9.1</code> and build it from scratch again.</p><p>The only thing I do with my global pyenv installation is install linting stuff and ensure things like <code>pip</code> and <code>setuptools</code> are always kept up to date. I actually do this with another bash function (keep scrolling&mldr;).</p><h3 id=virtual-environments>Virtual Environments</h3><p>I still recommend using virtual environments for basically everything:</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd my_project
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>python -m venv .venv
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># This now uses our magic pyenv version! we dont have to worry about saying python3.</span>
</span></span></code></pre></div><p>So my pyenv global python acts as if it were my system one (but far safer) and all my projects have their own virtual environments. If you do this too, it is virtually impossible for you to mess up your python installation and you&rsquo;ll never end up understanding the xkcd comic, and that&rsquo;s a good thing! üëç.</p><hr><h4 id=side-note-bash-functions>Side Note: Bash Functions</h4><p>By the way if you don&rsquo;t know the trick with bash functions:</p><ul><li><p>Create a file called <code>~/.my_commands.sh</code> (or whatever you want to call it actually, it doesn&rsquo;t matter) in your home directory.</p></li><li><p>Add the following line in your <code>~/.zshrc</code> file:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>source ~/.my_commands.sh <span style=color:#8b949e;font-style:italic># Or whatever you called it</span>
</span></span></code></pre></div><ul><li>Inside <code>.my_commands.sh</code> (or whatever you called it) write the functions you want in bash (e.g. my <code>maintenance</code> function below).</li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Inside ~/.my_commands.sh</span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic>#!/usr/bin/env bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Colours for nice terminal output</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>GREEN</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;\033[0;32m&#39;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>NC</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;\033[0m&#39;</span>
</span></span><span style=display:flex><span><span style=color:#79c0ff>LBLUE</span><span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>&#39;\033[1;34m&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Update all the things!</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72>function</span> maintenance<span style=color:#ff7b72;font-weight:700>()</span> <span style=color:#ff7b72;font-weight:700>{</span>
</span></span><span style=display:flex><span>    echo -e <span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>LBLUE</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>Updating and cleaning homebrew packages...\n</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>NC</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>    brew update
</span></span><span style=display:flex><span>    brew upgrade
</span></span><span style=display:flex><span>    brew cleanup -s
</span></span><span style=display:flex><span>    echo -e <span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>LBLUE</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>Updating Global python3 core dependencies...\n</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>NC</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span>    python -m pip install --quiet --upgrade pip setuptools wheel black mypy isort flake8
</span></span><span style=display:flex><span>    echo -e <span style=color:#a5d6ff>&#34;</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>GREEN</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>All done :)\n</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>NC</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff7b72;font-weight:700>}</span>
</span></span></code></pre></div><ul><li><p>Restart your terminal.</p></li><li><p>And now boom üí• you have a <code>maintenance</code> function you can just call like any other CLI tool from your terminal.</p></li></ul><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>maintenance
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8b949e;font-style:italic># Proceeds to do maintenance things...</span>
</span></span></code></pre></div><p>You can write bash functions like this to do all sorts of cool stuff for you automatically!</p><blockquote><p><strong>Automation is power!</strong></p><p>‚Äî <cite><em>Someone smart&mldr; probably</em></cite></p></blockquote></p></div><div class=prev-next></div></div></main><footer class=footer><span>&copy; 2023 Tom Fleet</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>